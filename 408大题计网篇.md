# 408大题计网篇
## 要求
* 每题吃透，反复横跳
## TCP的连接、拥塞控制和流量控制 16
![img](https://s1.ax1x.com/2020/10/31/BU3xje.jpg)
![img](https://s1.ax1x.com/2020/10/31/BU83CV.jpg)
### 解析
* 第一问：服务器发来第二次握手为SYN=1，ACK=1，seq=x(未知),ack=101
    * 拓展：本题中三次握手的过程
        * SYN=1，seq=100
        * SYN=1，ACK=1，seq=x(未知),ack=101
        * ACK=1，seq=101，ack=?(未知)
* 第二问

轮次|拥塞窗口|接收窗口|发送窗口
--|--|--|--|
1|1|20|1
2|2|19|2
3|4|17|4
4|8|13|8
5|16|5|5
6|32|0|0
7|33
8|34

接收了8个确认帧，接收窗口此时为20-8=12KB
拥塞窗口为9KB，发送窗口为9KB

* 第三问
 * 100+20K+1=101+20*1024=20581
 * 第五个轮次结束，共发送了20KB，平均数据传输率为20KB/（5*RTT）= 20.48 kbps
* 第四问
    * 断开连接即四次握手，怎么最短？服务器不需要发送数据，则可以变为“三次”握手，即1.5RTT=1.5*200=300ms
### 知识点背诵
* TCP连接管理
    * 三个阶段
        * 连接建立
        * 连接传送
        * 连接释放
    * TCP点对点连接，但连接的不是两台主机，而是套接字（插口）：IP地址+端口；每条TCP连接唯一地被通信两端的两个端点（即两个套接字）确定
    * 客户机/服务器模式
    * 图解三次握手（连接建立）
    ![img](https://s1.ax1x.com/2020/10/31/BUQUYT.jpg)
        * 客户机主动发起连接；服务器被动等待连接建立
        * SYN：同步位
            * SYN=1，ACK=0（图中省略），连接请求报文
            * SYN=1，ACK=1，连接响应报文（同意建立连接）
            * 总结：SYN=1表示请求连接或者同意连接，所以三次握手前两次都有SYN=1
        * ACK：响应位
            * 从服务器同意建立连接开始，所有传送的报文段ACK=1，即除了客户机发出连接请求时ACK=0（省略），其他全为1
        * seq：序列号
            * 发送帧的首位序号
            * 图中客户机发送了seq=x，说明发送的帧的首位为x，长度默认为1；而服务器发送seq=y，各发各的。
        * ack
            * 用于表示想要接收的帧的首位序号（通过这种形式进行确认（累计确认））
            * 服务器ack=x+1，是因为客户机发送seq=x，且长度为1，当服务器正确接收后，表示想要收的下一个帧的首位序号是x+1，说明x+1之前的帧都已正确接收；若是此时ack=x，说明未正确接收序号为1的帧
        * 存在问题
            * 服务器资源在第二次握手完成时分配，客户机资源在第三次握手完成后分配，服务器容易遭受洪泛攻击
                * 攻击者发送请求，但是不对其确认进行回复，以半挂起消耗服务器的CPU和内存。
                * 解决
                    * SYN Cookie

    * 图解四次握手（连接释放）
    ![img](https://s1.ax1x.com/2020/10/31/BUtnzV.jpg)
        * 客户机主动关闭，服务器被动关闭
        * FIN：终止位
            * 表示发送方的数据已经发送完毕
            * 图中首先由客户机发送FIN=1，seq=u，表明发送的最后的数据是u，并且数据发送完毕，之后不再发送数据
            * 总共出现两次，一次是客户机要关闭，一次是服务器要关闭
        * 服务器对其最后发送的数据进行响应
            * ACK=1，seq=v，（发送自己的序列），ack=u+1（作为确认方式）
        * 服务表示发送数据结束
            * FIN=1，ACK=1，seq=w，ack=u+1（继续确认u，所以使用了ACK=1）
        * 客户机收到连接释放，发出确认
            * 但是此时TCP连接并未释放，必须等待时间等待计时器设置的时间2MSL后，A才进入关闭状态
        * 不论三次握手还是四次握手，除了第一次请求外，其余均有ACK=1


## 网络拓扑 15
![img]()
### 知识点背诵
* DHCP动态主机配置协议
    * Dynamic host configuration protocol
    * 给主机动态分配IP地址，提供了即插即用联网的机制，允许一台计算机加入新的网络和获取IP地址而不用手工参与
    * 应用层协议，基于UDP
    * 客户机/服务器模式
    * 工作原理
        * 需要IP地址的主机启动时就向DHCP服务器发送发现报文，此时该主机成了DHCP的客户，本地主机上的所有主机都能收到此广播报文，但只有DHCP服务器可以应答（其中DHCP的回答报文称为提供报文）
        * DHCP服务器先在其数据库中查找该计算机的配置信息
            * 若有，返回信息
            * 若无，从服务器地址池中取一个地址分配给该计算机
    * 工作过程
        * DHCP客户机广播“DHCP发现”消息，寻找DHCP服务器
        * DHCP服务器收到“DHCP发现”消息，向网络中广播“DHCP”提供消息
            * 包括DHCP客户机的IP地址
            * 相关配置信息
        * DHCP客户机收到“DHCP提供”消息，如果接收DHCP服务器所提供的相关参数，那么通过广播“DHCP请求”向服务器请求提供IP地址
