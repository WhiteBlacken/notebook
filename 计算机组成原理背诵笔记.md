# 计算机组成原理背诵笔记
## 数据的表示与运算
* 结构
    * 数制与编码
        * 进位计数器及其相互转换
        * 真值和机器数
        * BCD码
        * 字符与字符串
        * 校验码
    * 定点数的表示和运算
        * 表示
            * 有符号数的表示
            * 无符号数的表示
        * 运算
            * 移位运算
            * 原码加减运算
            * 补码加减运算
            * 乘除运算
            * 溢出概念和判别方法
    * 浮点数的表示和运算
        * IEEE 754标准
        * 浮点数的加减运算
    * 算术逻辑单元
        * 串行加法器和并行加法器
        * ALU的功能和结构
## 指令系统
* 结构
    * 指令格式
        * 指令的基本格式
        * 定长操作码指令格式
        * 扩展操作码指令格式
    * 指令寻址方式
        * 有效地址的概念
        * 数据寻址与指令寻址
        * 常见寻址方式
    * CISC和RISC
### 指令格式
#### 概念
* 指令：指令（又称机器指令）是指计算机执行某种操作的命令，是计算机运行的最小功能单位。
* 指令集：一台计算机的所有指令的集合构成该机的指令系统（指令集）。
* 指令系统使计算机的主要属性
* 位于硬件和软件的交界面上
* 指令长度：一条指令所包含的二进制代码的位数。
    * 指令长度 vs 机器字长
        * 没有固定关系
        * 若指令长度=机器字长，称为单字长指令，则一次可以取出一条指令
        * 若指令长度=(1/2)机器字长，称为半字长指令，则一次可以取出两条指令
        * 若指令长度=2*机器字长，称为双字长指令，则一次可以取出半条指令
    * 指令长度固定 vs 不固定
        * 一个指令系统中，所有指令的长度相等，称为定长指令字结构
        * 若不等，称为变长指令字结构
#### 基本格式

操作字段|地址码字段|
--|--|

* 根据地址码字段的数目进行划分（除零地址指令，其余假定操作码长度8位，指令长度32位）
    * 零地址指令
        * 只有操作码。没有地址码
        * 适用于
            * 不需要操作数的指令
            * 指令在堆栈中
    * 一地址指令
        * 只有一个地址码。则操作码长度8位，地址码长度24位，寻址范围[0,2<sup>24</sup>=16M]
        * 适用于
            * 单操作数指令 OP(A<sub>1</sub>)->A<sub>1</sub>
                * 从A中读出，计算后放回A，如加1，减1，取反，求补
            * 隐含约定目的地址的双操作数指令 (ACC)OP(A<sub>1</sub>)->ACC
                * 可以约定另一操作数由ACC提供，运算结果也放在ACC中
    * 二地址指令
        * 操作码长度8位，每个地址码长度12位，寻址范围[0,2<sup>12</sup>=4K]
        * (A<sub>1</sub>)OP(A<sub>2</sub>)->A<sub>1</sub>
    * 三地址指令
        * 操作码长度8位，每个地址码长度8位，寻址范围[0,2<sup>8</sup>]
        * 最后一个地址码字段存放运算结果
        * (A<sub>1</sub>)OP(A<sub>2</sub>)->A<sub>3</sub>
        * 共需访存4次，取指令一次，取操作数两次，存放结果一次
    * 四地址指令
        * 操作码长度8位，每个地址码长度6位，寻址范围[0,2<sup>6</sup>]
        * (A<sub>1</sub>)OP(A<sub>2</sub>)->A<sub>3</sub>
        * 最后一个地址码字段存放下一条指令的地址
#### 定长操作码 vs 变长操作码
##### 定长操作码
* 在指令字的最高位部分分配固定定长表示操作码
* 即n位操作码字段的指令系统一般最大能够表示2<sup>n</sup>条指令
* 评价
    * 简化计算机硬件设计，提高指令译码和识别速度
    * 当计算机字长32位或更长，这是常规用法
##### 变长操作码（主要介绍扩展操作码）
* 动手模拟
* 要求
    * 短码不能是长码的前缀
    * 各指令的操作码不能重复
* 对使用频率较高的指令分配较短的操作码，频率较低使用较长的操作码（符合哈夫曼编码的思想）
* 评价
    * 在指令字长有限的情况下仍保持比较丰富的指令种类
    * 但是增加了指令译码和分析的难度，使控制器设计复杂化
### 指令的寻址方式
* 分为指令寻址和数据寻址
* 形式地址 vs 真实地址
    * 指令中的地址码字段并不代表真实地址，称为形式地址(A)
    * 形式地址结合寻址方式，可以计算出操作数在存储器中的真实地址，这种地址称为有效地址(EA)
#### 指令寻址
* 寻找下一条将要执行的指令地址称为指令寻址
* 方式
    * 顺序寻址方式
        * 通过PC+1，自动形成下一条指令的地址
    * 跳跃寻址方式
        * 通过转移类指令实现。下条地址的地址码由本条指令给出。
        * 跳跃到的地址分为绝对地址和相对地址
            * 绝对地址：由标记符直接得到的地址
            * 相对地址：相对于当前指令的偏移量
        * 跳跃的结果是当前指令修改PC的值，下条指令仍由PC给出
#### 数据寻址
* 寻找操作数的地址
* 数据寻址的方式较多，为区分各种方式，通常在指令字段中设一个字段，用来指明属于哪种寻址方式

操作码|寻址特征|形式地址A|
--|--|--|
* 常见的数据寻址方式
    * 隐含寻址
    ![img](https://s1.ax1x.com/2020/10/14/05Y6yQ.jpg)
        * 另一个操作数隐含在ACC寄存器中
        * 有利于缩短指令字长，但是需要增加存储操作数或者隐含地址的硬件
    * 立即（数）寻址
        * 地址字段直接放置操作数本身，采用补码形式放置
        * 寻址特征：#
        * 指令执行不访问主存，指令执行时间最短；但A的位数限制了立即数的范围
    * 直接寻址  
        * 形式地址A中存放操作数的真实地址
        * 代码执行过程中只需访问一次主存，不需要专门计算操作数的地址。但A的位数决定了该指令操作数的地址范围，且地址不易修改 
    * 间接寻址
        * 相对于直接寻址而言的，形式地址并非操作数的真正地址，而是操作数有效地址所在的存储单元的地址。
        * 可以是一次间接寻址（访存两次），可以是多次间接寻址（访存三次）
        * 如何区分是几次间接寻址？
            * 主存字第一位是1时，表示取出的仍不是操作数的地址；
            * 主存字第一位为0时，表示取得是操作数的地址
        * 评价
            * 可以扩大寻址范围，便于编制程序
            * 执行期间多次访存，访存速度过慢（故并不常用，想要扩大寻址范围时，通常使用寄存器间接寻址）
    * 寄存器寻址
        * 指令字中直接给出操作数所在的寄存器编号
        * 评价
            * 指令执行期间不访问主存，只访问寄存器，寄存器数量少，导致地址码长度短，一方面执行速度快，一方面寄存器个数有限且昂贵
    * 寄存器间接寻址
        * 寄存器寻址与间接寻址相结合，寄存器中不是给出操作数，而是操作数所在主存单元的地址
        * 导致比间接寻址少一次访存
        * 评价
            * 比一般间接寻址快
            * 但执行过程中需要访问主存
    * 相对寻址
        * 对PC的相对偏移量决定有效地址
        * 评价
            * 操作数的位数不是固定的，但与指令地址之间总有一个固定差值，便于程序浮动，广泛用于转移指令
            * A的位数决定操作数的寻址范围
    * 基址寻址 vs 变址寻址
        * 基址寻址
            * 相对于相对寻址，此处是基址寄存器中的内容加上形式地址形成操作数的有效地址
            * 基址存储器面向操作系统，用于解决程序逻辑和存储器物理空间无关性
            * 基址内容不变（基地址），形式地址可变（偏移量）
            * 评价
            * 扩大了寻址范围
            * 但是偏移量（形式地址A的位数较短）
        * 变址寻址
            * 有效地址EA等于指令字中的形式地址A与变址寄存器IX内容之和
            * 变址寄存器面向用户，程序执行过程中，变址寄存器的内容可由用户改变（作为偏移量），形式地址A作为基地址（与基址寻址正好相反）
            * 评价
                * 可以扩大寻址范围
                * 在数组处理过程中，可设定A为数组首地址，不断改变变址寄存器iX的内容，就能容易形成数组任一数据的地址，特别适合编制循环程序
        * 比较
            * 基址寄存器面向操作系统，主要用于为多道程序或数据分配存储空间，其内容由操作系统或者管理员来确定，执行过程中其值不变，指令字中的A可变
            * 变址寻址立足于用户，主要用于处理数组问题，在变址寻址中，变址寄存器的内容由用户设定，在程序执行过程中其值可变，指令字中A不变（感受两者的对应关系）
    * 堆栈寻址
        * 后进先出的存储区，读写单元的地址由特定的寄存器给出，该寄存器成为堆栈指针（SP）
        * 在每个读写单元背后都伴有自动完成对SP内容的增量或减量操作
        * 分类
            * 硬堆栈
                * 寄存器堆栈
                * 成本高，故容量不大
            * 软堆栈
                * 主存堆栈
                * 合适且常用
* 分析各种方法的访存次数
![img](https://s1.ax1x.com/2020/10/14/0I34X9.jpg)
### CISC和RISC
* CISC  
    * Complex Instruction Set Computer
    * 指令条数：指令复杂庞大，在200条以上
    * 指令长度：指令长度不固定，格式多，寻址方式多
    * 限制：可以访存的指令不受限制
    * 使用平率：各种指令使用频率差距大
    * 指令复杂故使用微程序，而无法使用硬布线
    * 难以优化编译生成呢个高效的目标代码程序
* RISC  
    * Reduced Instruction Set Computer
    * 选取使用高频简单指令，复杂指令用简单指令组合
    * 指令长度固定，种类少
    * 只有LOAD和STORE可以访存，其余都在寄存器之间进行
    * 通用寄存器多
    * 采用流水线，大部分指令在一个时钟周期内完成
    * 以硬布线为主
    * 重视优化编译
    * 目前很难和老机器兼容
    
***
## 中央处理器
* 内容
    * CPU的功能和基本机构
    * 指令执行过程
    * 数据通路的功能和基本结构
    * 控制器的功能和工作原理
        * 硬布线控制器
        * 微程序控制器
    * 指令流水线
        * 基本概念
        * 流水线的基本实现
        * 超标量和动态流水线的基本概念
### CPU的功能
* 指令控制
* 操作控制
* 时间控制
* 数据加工
* 中断处理
### 基本结构
* 运算器
对数据进行加工处理

寄存器名称|作用
--|--|
算术逻辑单元|
暂存寄存器|
累加寄存器|
通用寄存器|
程序状态字寄存器|
移位器|
计数器|

* 控制器
执行指令，根据指令操作码、微命令序列和条件信号生成控制信号

* 类型
    * 硬布线
    * 微程序控制器

寄存器名称|功能|
--|--|
程序计数器|PC
指令寄存器|保存当前在执行的指令
指令译码器|仅对操作码进行译码，向控制器发操作信号
存储器地址寄存器|存放将要访问主存单元的地址
存储器数据寄存器|要写入/读出主存的信息
时序系统|时序信号，由统一时钟分解而来
微操作信号发生器|根据IR和PSW的内容及时序信号，产生各种控制信号

微操作发生器的结构分为 组合逻辑型和存储逻辑型

* 内部寄存器对用户是否可见
    * 可见，可编程：通用寄存器，程序状态字寄存器
    * 不可见：存储器地址寄存器，存储器数字寄存器，指令寄存器

### 指令执行过程
#### 指令周期
* CPU从主存中取出并执行一条指令的时间叫做指令周期，不同指令的指令周期可能不同。指令周期常用若干机器周期来便是，一个机器周期又包含若干时钟周期（节拍或T周期，CPU操作的最基本单位）
* 机器周期：CPU周期，把一条指令分为若干阶段（取指，译码，执行等）,每一阶段完成一个基本操作，完成一个基本操作的时间称为机器周期
    * 定长机器周期 vs 不定长机器周期
        * 包含的节拍数是否固定
* 完整的指令周期

取指周期|间址周期|执行周期|中断周期
--|--|--|--|

    * 不是每种指令都有4个周期，间址周期在间接寻址的指令中出现
    * 四个工作周期都有访存，目的不同
        * 取指：取出指令
        * 间址：取出有效地址
        * 执行：取出操作数
        * 中断：保存程序断点
    * 如何区分四个周期？
        * 4个标志触发器FE、IND、EX、INT
    * 中断周期中的进栈操作SP-1，因为计算机的堆栈中都是朝低地址增加
#### 指令周期的数据流
* 数据流是根据指令要求依次访问的数据序列，在指令执行的不同阶段，要求依次访问的数据序列是不同的，而且对于不同的指令，他们的数据流往往也是不同的
* 分阶段讨论
    * 取指周期
        * 任务
            * 根据PC中的内容从主存中取出指令代码并存放在IR中
        * 过程
            * PC向MAR发出指令地址，通过地址总线，向内存进行访问
            * CU发出控制信号，通过控制总线，向主存发出命令
            * 主存通过数据总线将指令数据传入MDR，然后放入IR
            * CU发出读命令，读出IR中的内容，然后IR加1
    * 间址周期
        * 任务
            * 取操作数的有效地址
        * 过程
            * Ad(IR)向MAR发出地址信息，通过地址总线，发送给主存
            * CU发出控制信号，通过控制总线，向主存发出命令
            * 主存通过数据总线，将有效地址数据发送给MDR
    * 执行周期
        * 任务
            * 通过IR中指令的操作码和操作数通过ALU操作产生执行结果
        * 过程
            * 不同指令指令周期操作不同，因此没有统一的数据流向
    * 中断周期
        * 任务
            * 处理中断请求（设备控制中程序中断是在此周期执行，即执行周期结束后，而DMA可以在每个阶段结束后执行）
        * 过程
            * CU控制将SP减1，SP通过MAR通过地址总线访问主存
            * CU发出写命令，通过控制总线，向主存发出信息
            * PC通过MDR通过数据总线，将程序断点写入内存
            * CU中断服务程序的入口地址写入PC
#### 指令执行方案
* 串行
    * 单指令周期
        * 执行时间不同的指令选用相同的周期，则指令周期取决于最长的指令的执行时间
    * 多指令周期
        * 指令需要几个周期就给他分配几个周期
* 并行
    * 流水线
        * 力求在每个时钟脉冲周期完成一条指令的执行过程（理想情况）
        * 每个时钟周期启动一条指令，尽可能让多条指令同时运行，但各自处在不同的执行步骤中
### 数据通路的功能和基本结构
#### 功能
* 实现**CPU内部**的运算器与寄存器及寄存器之间的数据交换
* 数据在功能部件之间传送的路径称为数据通路；路径上的部件称为数据通路部件，如ALU，通用寄存器、状态寄存器、异常和中断处理逻辑
* 数据通路描述了信息从什么地方开始，之间经过了哪个寄存器或多路开关，最后传送到哪个寄存器
* 使用执行部件或功能部件进行专门的数据运算，使用控制部件进行控制
* 内部总线 vs 系统总线
    * 内部总线：部件内部的总线，如CPU内连接寄存器和ALU之间的总线
    * 系统总线：计算机内部连接不同部件的总线
#### 基本结构
* CPU内部单总线
    * 冲突多，性能低
    * 一个时钟内只允许传送一个数据
* CPU内部三总线
    * 在多个总线上传输不同数据
* 专用数据通路方式
    * 不使用总线，根据数据和地址的流动方向安排连接线路，性能高但是硬件量大
#### 部件间或部件内部的数据传送
* 寄存器之间
    * 通过CPU内部总线
    * 若PC向MAR传送
        * PC传送至总线
        * 总线传送给MAR
* 主存和CPU之间
    * 参考取值周期（不过重点关注CPU内部如何通过总线传输数据）
* 执行算术或逻辑运算
    * ALU本身没有存储功能，故相加的两个数在ALU两个输入端必须同时有效，这要使用暂存器Y来实现
    * 先将一个操作数经CPU内部总线送入暂存寄存器Y保存，Y的内容在ALU的左输入端始终有效，再将另一个操作数经总线直接送到ALU右输入端。计算结果暂存在暂存器Z中
### 控制器的功能和结构 danger
#### 硬布线
#### 微程序控制器

## 总线
### 总线概述
* 总线定义
    * 分时、共享的公共信息传输线路
    * 分时要求不能同时发送消息，共享指可以通过该线路进行信息交换，且能接收相同的消息
* 总线设备
    * 主设备（有总线控制权）
    * 从设备
* 总线特性
    * 机械特性（尺寸，形状）
    * 电气特性（传输方向和电平范围的数值）
    * 功能特性（传输线的功能）
    * 时间特性（信号和时序的关系）
* 猝发传输方式
    * 在一个总线周期内传输存储地址连续的多个数据字的总线传输方式
* 总线分类
    * 按功能（连接设备）划分
        * 片内总线
            * 连接CPU内部件
        * 系统总线
            * 连接计算机内部件
        * 通信总线
            * 连接计算机网络间主机
    * 按时序控制方式划分
        * 同步总线
        * 异步总线
    * 按数据传输格式划分
        * 并行总线
        * 串行总线
* 其中系统总线
     * 分类
        * 数据总线（区分于数据通路，总线是介质，通路是路径）
        * 地址总线
        * 控制总线
    * 结构划分（会画图p264）
        * 单总线
            * 将CPU、主存、I/O挂载在同一条总线上，可以直接进行信息交换，无需其他设备干预
            * 注意区分：并非只有一条信号线，还是分为数据、地址、控制，只是设备挂载方式
        * 双总线
            * 将低速I/O设备分离，分为存储器总线（主存总线，用于CPU、主存和通道的通信）和I/O总线
            * 需要增加通道等硬件设备
        * 三总线（结合DMA控制方式）
            * 主存总线（CPU和主存），I/O总线（主存和外设），DMA总线（主存和高速外设）
            * 提高I/O设备性能，提高系统吞吐量，但是系统效率较低
* 总线的性能标准
    * 总线传输周期和工作频率
        * 总线传输周期
            * 一次总线操作所需时间，由若干总线时钟周期构成
            * 包括
                * 申请阶段
                * 寻址阶段
                * 传输阶段
                * 结束阶段
        * 总线工作频率
            * 总线周期的倒数
            * 总线上各种操作的频率，即1秒内传送几次数据
            * 若总线周期为N个时钟周期，则工作频率=时钟频率/N
    * 总线时钟周期和总线时钟频率
        * 即计算机的时钟周期（机器时钟周期，计算机内部统一的），实际上与总线本身无关
    * 总线宽度和总线带宽
        * 总线宽度
            * 又称总线位宽，总线上能够同时传输的数据位数，即数据总线的根数
        * 总线带宽
            * = 总线频率*总线宽度/8
            * 除8是因为以B/s为单位，要把 bite 转换为 字节
    * 信号线数和总线复用
        * 信号线数
            * 地址、数据、控制总线三者之和
        * 信号线数
            * 一种信号线在不同时间传输不同信息（若是一条线能够传输地址、数据、控制，那么只要在不同时间进行传输，就可以将线的条数减少至N/3）
### 总线定时
* 总线定时是指总线在双方交换数据过程中需要时间上配合关系的控制，实质是一种协议或规则
    * 分类
        * 同步定时方式
            * 收发双方采用统一的时钟信号
            * 优：传送速度快，具有较高的数据传输速率；总线控制逻辑简单
            * 缺：主从设备属于强制性同步；不能及时进行数据通信有效性检验，可靠性差
            * 适合于总线长度较短及总线所接部件的存取时间比较接近的系统
        * 异步定时方式
            * 无统一时钟，依靠传送双方相互制约的“握手”信号来实现定时控制
            * 优点：总线周期长度可变，能保证两个速度相差很大的部件或设备间可靠
            * 主设备提出“请求”信号，从设备发出“回答信号”；根据“请求”“回答”信号的撤销是否互锁，可以分为3种类型
                * 不互锁方式
                    * 主设备发出“请求”，不必接收“回答”，而是过一段时间自动撤销；从设备发出“回答”，等一段时间自动撤销；不存在互锁关系
                * 半互锁方式
                    * 主设备发出“请求”，必须等到“回答”，才撤销，存在互锁；从设备发出“回答”，过一段时间自动撤销，不存在互锁；
                * 全互锁方式
                    * 主设备发出“请求”，必须等到“回答”，才撤销，存在互锁；从设备发出“回答”，必须在获取注设备“请求”已经撤销以后，再撤销其“回答”信号，互锁；
#### 误区
* 不同速度的设备间既可以用同步控制方式，也可以使用异步控制方式，只是使用同步控制方式不能发挥快速设备的高速性能而已。


### 总线标准
总线标准|全称|工作频率|数据位数|最大速度|特点
--|--|--|--|--|--|
ISA|industry standard architecture|8MHz|8/16|8MB/s|系统总线|
EISA|Extended ISA|8MHz|32|32MB/s|系统总线
PCI|外设Peripheral Component interconnect|33MHz|32|133MB/s|局部总线
AGP|显卡accelerated Graphics port|||x1：266MB/s x8：2.1GB/s|局部总线
VESA|video eletronics standard architecture|33MHz|32|132MB/s|局部总线
PCI-E|通用总线规格|||10GB/s以上|串行
USB|universal serial bus|||1280MB/s|设备总线
RS-2232|串行通信接口标准|||20kbps|串行通信总线
IDE(ATA)|Integrated Drive Electronics|||100MB/s|硬盘光驱接口
SATA|串口硬盘|||600MB/s|串行硬盘接口
PCMCIA|个人电脑存储卡|||90Mbps|便携设备接口
SCSI|小型计算机接口|||640MB/s|智能通用接口

* 汇总
串行总线：USB，SATA，RS，PCI-E（串行总线无法同时传输两位数据）
并行总线：PCI，EISA，ISA

系统总线：ISA，EISA
局部总线：PCI，AGP，VESA

用于设备和设备控制器（I/O接口）之间的互连的接口标准是USB
USB的特点
* 即插即用，热插拔
* 有很强的连接能力，采用菊花链将众多外设连接连接起来
* 很好的可扩充性，一个USB控制器可以扩充高达127个外部USB设备
* 高速传输，速率可达480Mb/s
* 是串行总线，不可同时传输两位数据
#### 题目怎么说
* 靠近CPU的总线速度较快
    * 这也是为什么将I/O总线和主存总线分离的原因
* 总线间必须用桥接器相连
    * 桥接器可以进行速度划分和流量交换'
* 并行总线传输不一定比串行总线传输快
* 分离事物通信方式时总线复用的一种，相比单一的传输线路可以提高总线的利用率
* 多通道存储器总线
    * 在动态随机存储体和存储器控制器/芯片组之间，增加更多的并行通信通道，以增加数据发送的带宽
    * 理论上每增加一条通道，数据发送性能相较于单通道而言会增加一倍
    * 即求三通道的带宽时要*3
***
## 输入/输出系统
### I/O系统基本概念
* I/O系统的组成
    * I/O硬件
    * I/O软件
        * I/O设备同过设备控制器来与主板的系统总线相连
### 外部设备
* 输入设备
    * 键盘
    * 鼠标
        * 机械式
        * 光电式
* 输出设备
    * 显示器
        * 性能指标
            * 屏幕大小
            * 分辨率
            * 灰度级
                * 像素的亮暗程度，典型的有8位（256级），16位
            * 刷新和刷新频率
                * 光电只能保持很短就消失，在消失前必须重新扫描显示一遍
                * 刷新频率是单位时间内扫描整个屏幕内容的次数；人眼不感到闪烁，要>30Hz，通常在60-120Hz
            * 显示存储器（VRAM）
                * 刷新存储器，存储刷新图像信息
                * VRAM容量 = 分辨率 * 灰度级位数
                * VRAM频率 = 分辨率 * 灰度级位数 * 帧频
        * 分类
            * 阴极射线管（CRT）显示器
                * 字符显示器
                    * 以点阵为基础，将点阵存入ROM构成的字符发生器
                * 图形显示器
                    * 一组坐标点和绘图命令组成显示文件存放在缓冲存储器，发给矢量（线段）产生器
                    * 分辨率高且显示曲线平滑（高质量图形显示器采用这种随机扫描方式）
                    * 显示复杂图形时有闪烁感
            * 液晶显示器   
                * 液晶的电光效应
            * LED（发光二极管）显示器
                * 控制半导体发光二极管
                * 与LCD相比，LED显示器在亮度、功耗、可视角度和刷新速率等方面都更有优势
    * 打印机
        * 按工作原理分类
            * 打击式
            * 非打击式
        * 按工作方式分类
            * 针式打印机
                * 打印头
                * 擅长“多层复写打印”，实现票据和蜡纸的打印。实现原理简单，造价低廉，耗材便宜，但打印分辨率和打印速度不够高。
            * 喷墨式打印机
                * 喷墨雾点
                * 打印噪声小，可实现高质量彩色打印，通常比针式打印机快；防水差，高质量打印需专用打印纸
            * 激光打印机
                * 激光束，感光鼓（核心部件）；
                * 打印质量高，速度快，噪声小，处理能力强；耗材多，价格贵，不能复写打印多份，对纸张要求高
                * 激光技术和电子显像技术相结合的产物
* 外存储器
    * 主要是磁表面存储器：把某些磁性材料薄薄地涂在金属铝或塑料表面上作为载磁体来存储信息
    * 包括磁盘存储器、磁带存储器、磁鼓存储器
    * 评价
        * 优点
            * 存储容量大，位价格低
            * 记录介质可重复使用
            * 记录信息可长期保存而不丢失，甚至可脱机存档
            * 非破坏性读出
        * 缺点
            * 存取速度慢
            * 机械结构复杂
            * 对工作环境要求较弱
    * 磁盘存储器
        * 组成
            * 存储区域
                * 磁头数，一个记录面对应一个磁头
                * 柱面数，每面盘片上有多少磁道
                * 扇区数，每条磁道有多少扇区
            * 硬盘存储器的组成
                * 磁盘驱动器
                    * 核心部件是磁头组件和盘片组件，温彻斯特盘是一种可移动磁头固定盘片的硬盘存储器
                * 磁盘控制器
                    * 硬盘存储器和主机的接口，主流的标准有IDE，SCSI，SATA
                * 盘片
        * 记录原理
            * 
        * 性能指标
            * 磁盘的容量，磁盘所能存储的字节总数
                * 非格式化容量
                * 格式化容量，按照特定记录格式所能存储信息的容量
            * 记录密度
                * 盘片单位面积上记录的二进制信息量
                * 面密度=道密度（半径）*位密度（磁道）
            * 平均存取时间
                * 自由寻道时间+旋转延迟时间+传输时间
            * 数据传输率
                * 单位时间内向主机传送数据的字节数
                * = 转数r转/s * 每条磁道通量N字节
        * 磁盘地址
            
            驱动器号|柱面号（磁道号）|盘面号|扇区号|
            --|--|--|--|
        * 工作过程
            * 寻址、读盘、写盘
            * 每个操作对应一个控制字，第一步是取控制字，第二步是执行控制字
        * 特点
            * 机械式部件
            * **读写是串行**，不可能又读又写，也不能同时读或写两组数据
    * 磁盘阵列
        * RAID（廉价冗余磁盘阵列）
            * 多个独立的物理磁盘组成一个独立的逻辑盘
            * 数据在多个物理盘上分割交叉存储、**并行访问**
            * 更好的存储性能、可靠性、安全性
        * 分级
            * RAID0~RAID5
            * 其中1~5，无论何时有磁盘损坏，都可随时拔出受损的磁盘再插入好的磁盘，而数据不会损坏
            * 0扩大了存储容量，提高了存储速度，但是没有存储能力
    * 光盘存储器
        * 利用光学原理读/写原理，采用聚焦激光束对盘式介质以非接触方式记录信息
        * 分类
            * CD-ROM
                * 只读型光盘
            * CD-R
                * 只可写入一次
            * CD-RW
                * 可读可写
            * DVD-ROM
                * 高质量CD-ROM，DVD表示通用数字化多功能光盘
    * 固态硬盘
        * 微小型高档笔记本使用高性能Flash Memory，还需要其他硬件、软件的支持
### I/O接口（I/O控制器）
* 解决主机和外设在信息形式和工作速度上的差异
* 功能
    * 实现主机和外设的通信联络控制
        * 时序配合，协调速度不同的问题
    * 进行地址译码和设备选择
        * CPU送来选择外设的地址码，接口必须对地址进行译码以产生设备选择信息
    * 实现数据缓冲
        * 速度差异
    * 信息格式的转换
        * 电平、数据格式差异
    * 传送控制命令和状态信息
        * 如启动，中断等过程
* I/O指令
    * 对数据缓冲寄存器、状态/控制寄存器的访问操作是通过相应的指令来完成的，称为I/O指令
    * I/O指令只能在操作系统内核的底层I/O软件中使用，是**特权指令**
* 端口vs接口
    * 端口是指接口电路中可以进行读/写的寄存器
    * 接口=若干端口+控制逻辑
* I/O接口的类型
    * 按数据传输方式
        * 并行接口
        * 串行接口（**此处的串行是指外设和接口一侧的，接口与主机的一侧始终是并行传送）
    * 按I/O设备控制方式
        * 程序查询家口
        * 中断接口
        * DMA接口
    * 按功能的灵活性
        * 可编程接口
        * 不可编程接口
* I/O端口及其编址
    * 分为
        * 数据端口（可读可写）
        * 控制端口（只能写）
        * 状态端口（只能读）
    * 端口的编址方式（便于CPU寻址）
        * 统一编址（存储器映射方式）
            * 把I/O端口当作存储器的单元进行地址分配
            * 优：CPU不需要设置单独的I/O指令
            * 缺点：内存容量被占用，执行速度慢
        * 独立编址（I/O映射方式）
            * I/O端口的地址空间与主存的地址空间独立，无法通过地址码的形式区分，需要设置单独的I/O指令来访问I/O端口
            * 优：输入/输出指令和存储器指令有明显区别，程序编制清晰，便于理解
            * 缺：输入/输出指令少，一般只能对端口进行传送操作，尤其需要CPU提供存储器读/写、I/O设备读/写两组控制信号，增加了控制复杂性
### I/O方式
#### 程序查询方式
* CPU不断查询I/O设备的状态，直到外设准备就绪
* CPU一旦启动I/O，就必须立即停止现行程序的运行，CPU与I/O串行工作
* 一段时间内只能和一台外设交换信息
#### 程序中断方式
* CPU与I/O设备并行工作
* 中断系统可用来实现多道程序、分时操作，多道程序的切换
* 应用程序和操作系统（管态程序）的切换，被称为“软中断”
* 中断请求
    * 按照中断源分为
        * 内中断
            * 处理处理器内部和内存内部产生的中断
        * 外中断
            * **处理器和内存以外**的部件引起的中断
                * I/O中断
                * 外部信号中断（用户按ESC）
                * 定时器引起的时钟中断
        * 内中断
            * 处理器和内存内部产生的中断
                * 程序运算引起的错误
                    * 地址非法
                    * 校验错
                    * 页面失效
                    * 存取访问控制错
                    * 算术操作溢出
                    * 数据格式非法
                    * 除数为0
                    * 非法指令
                    * 用户程序执行特权指令
                    * 分时系统的时间片中断
                    * 用户态到核心态的切换
    * 按照硬软件方式
        * 硬件中断：外中断
        * 软件中断：内中断，可以编程实现
    * 按照是否可屏蔽
        * 非屏蔽中断
            * 硬件终端，不可屏蔽中断请求NMI控制，不受中断标志位IF的影响，即使关中断（IF=0）也会被响应
        * 可屏蔽中断
            * 也是硬件中断，通过中断请求标记触发器INTR控制，且受IF标志位的影响
* 中断判优
    * 一次只能响应一个，选择优先级最高的
    * 优先级：硬件大于软件，非屏蔽大于屏蔽，DMA请求大于I/O中断请求，高速大于低速，输入设备大于输出设备，实时设备大于普通设备
    * 实现方式
        * 硬件
            * 硬件排队器
        * 软件
            * 查询程序
* CPU响应中断的条件
    * 中断源有中断请求
    * CPU允许中断及开中断
    * 一条指令执行完毕，且没有更紧迫的任务

**在外中断中，I/O设备的就绪时间是随机的，但是CPU只在每条指令执行阶段的结束时刻才去响应中断**

* 中断隐指令
    * CPU响应中断后，由硬件经过操作，转去执行中断服务程序，这些指令被称作中断隐指令
    * 并不是指令系统的一条真正指令，没有操作码，不可为用户使用
    * 包括的操作
        * 关中断
    * 保存断点（PC中的内容）
    * 引出中断服务程序
        * 取出中断服务程序的入口地址（中断向量），传输给程序计数器
* 中断向量
    * 中断服务程序的入口地址
    * 系统中全部中断向量集中存放到存储器的某个区域，这个存储区被称为中断向量表，即中断服务程序入口地址表
    * **中断向量是中断服务程序的入口地址，中断向量的地址是中断服务程序的入口地址的地址**
* 中断处理过程

次序|特点|实现方式
--|--|--|
关中断||中断隐指令，硬1
保存断点||中断隐指令，硬2
中断服务程序寻址|将中断服务程序入口放入PC|中断隐指令，硬3
保存现场和屏蔽字||中断服务程序，软1
开中断|允许嵌套中断|中断服务程序，软2
执行中断服务程序||中断服务程序，软3
关中断|保证下一步不受中断|中断服务程序，软4
恢复现场和屏蔽字||中断服务程序，软5
开中断，中断返回||中断服务程序，软6

* 执行中断过程中，若出现更高优先级的中断请求，如何处理
    * 不予响应
        * 单重中断
    * 暂停现行，处理新中断（常用）
        * 多重中断（中断嵌套）
        * 具备多重中断的条件
            * 中断服务程序中提前设置开中断
            * 优先级高的中断源有权中断优先级别低的中断源
        * 每个中断源都有屏蔽触发器，表示屏蔽该中断源请求，表示可以正常申请，所有屏蔽触发器组合在一起便构成了屏蔽字寄存器，内容成为屏蔽字
#### DMA方式（直接存储器存取方式）
* 完全由硬件进行成组信息传送的控制方式，在外设和内存之间开辟了一条“直接数据通道”，信息传送不经过CPU，故不需要保护、恢复CPU现场等操作，中断的作用仅为故障和正常传送结束的处理
* 适用于磁盘机、磁带机等高速设备大批量数据的传送，硬件开销大
* 特点
    * 主存与CPU脱钩，既可以被CPU访问，也可以被外设访问
    * 数据传送时，主存地址的确定，传送数据的计数都由硬件电路直接实现
    * 主存中要开辟专用缓冲区
    * 传送速度快，CPU和外设并行工作，提高了系统效率
    * 开始前要进行程序预处理，结束后要通过中断进行后处理
* 执行过程
    * DMA控制器想CPU提出DMA传送请求
    * CPU响应后让出系统总线
    * DMA控制器接管总线进行数据传输
* DMA控制器的组成
    * 主存地址计数器
        * 存放主存地址
    * 传送长度计数器
        * 记录传送数据的长度，溢出时自动发出中断
    * 数据缓寄存器
        * 暂存每次传送的数据
    * DMA请求触发器
        * I/O设备准备好数据后，给出一个控制信号，使DMA请求触发器置位
    * “控制/状态”逻辑
        * 指定传送方向，对DMA请求信号和CPU响应信号进行协调和同步
    * 中断机构
        * 一个数据块传送完毕，触发中断机构，向CPU提出中断请求

DMA传送过程中，DMA控制器将接管CPU的三总线，CPU的主存控制信号将被禁止使用。**DMA控制器必须具有控制系统总线的能力**

* 主存和I/O设备交换信息时，不通过CPU；但是当I/O设备和CPU同时访问主存时，可能发生冲突，可以使用三种方式来解决DMA控制器和CPU对主存的争用
    * 停止CPU访问主存
        * 外设需要传送成组数据时，DMA接口向CPU发送信号，要求CPU放弃三总线的使用权。CPU基本处在不工作或者保持原始状态
    * DMA与CPU交替访问
        * 适合于CPU工作周期比主存存取周期长的情况。将CPU的一个周期分为两段，一段专供DMA访存，一段专供CPU访问；没有使用权的申请、建立和归还的过程。
    * 周期挪用（周期窃取）
        * 前两种方法的折中。
        * 无DMA请求，CPU按需正常访问
        * 有DMA请求，分为三种情况
            * CPU不在访存，不冲突
            * CPU在访存，等CPU存取周期结束，再将总线占有权让出（与停止CPU访问主存相比，对CPU宽容了一点）
            * I/O和CPU同时访存，CPU要暂时放弃总线占有权，由I/O设备挪用一个或几个存取周期
* DMA的传送过程
    * 预处理
        * 由**CPU完成必要的准备工作**，执行几条I/O进行测试，然后CPU继续执行原来的程序；I/O设备准备好发送或接收的数据，向DMA发送DMA请求，DMA控制器向CPU发送总线请求
    * 数据传送
        * 基本单位：字节，字，数据块
        * 数据输入和输出都是通过循环实现的，整个数据传送阶段完全由**DMA（硬件）控制**
    * 后处理
        * DMA控制器向CPU发送中断请求，**CPU执行中断服务程序**做DMA结束处理，包括校验送入内存的数据是否正确、测试传送数据是否出错（错误则转入诊断程序），及决定是否继续使用DMA传送其他数据。
* DMA方式 vs 中断方式

方式|DMA方式|中断方式|
--|--|--|
CPU资源|除预处理和后处理以外，不需要CPU资源；传送完全由DMA硬件控制，传输速率高|是程序切换，保护和恢复现场；传送需CPU干预
CPU响应时间|每个机器周期结束均可（只要CPU不占用总线）|必须指令的执行周期后|
请求优先级|高|相对低|
功能|对异常事件处理|仅用作I/O传输|
数据传送|程序传送|硬件传送|
##### 题目怎么说
* I/O指令是CPU系统指令的一部分，是机器指令的一类，但为了反应其与I/O设备交互的特点，格式与其他通用指令有所不同
* I/O总线分为三类
    * 数据线：传送数据缓冲寄存器和命令/状态寄存器中的内容
    * 地址线：传送与CPU交换数据的端口地址
    * 控制线：给I/O端口发出读/写信号
* 浮点数运算是否可以提出中断？
    * 浮点数下溢，可以当做机器0处理，不需要提出中断；
    * 浮点数上溢，必须中断做相应处理
* 能产生DMA请求的是具有DMA接口的外部设备，这包含两层含义
    * 要具有DMA接口
    * 设备发出的DMA请求，而不是DMA控制器，其发出的是对CPU的总线请求
* 中断响应周期中，CPU（硬件）完成的主要是中断隐指令，中断服务程序由软件完成
* 0和1，0表示关中断，在中断隐指令开始就要置0，
* 中断屏蔽标志改变的是CPU对多个中断请求的**处理优先级**，并非访问优先级

类型|中断响应优先级|中断处理优先级
--|--|--|
方法|硬件排队或软件程序查询顺序，不能动态改变|中断屏蔽字
是否动态|不能动态改变|反应的是正在处理的中断是否比新发生的中断处理优先级低，为0时对新中断开放
所属方面|中断判优，同时多个中断，选择一个响应|中断内嵌，已有中断执行，判断是否取代|
* 中断发生时，程序计数器内容的保护和更新是由**硬件自动**完成的，即中断隐指令
* CPU响应中断，保护的两个关键的硬件状态时 PC 和 PSW
* 若不开中断，所有中断请求就不能响应？
    * 错误，内中断是不可被屏蔽的
* 在中断I/O方式中，数据传送是由CPU来完成的，所以CPU不用向打印接口发送**主存地址**
* DMA传送前由设备驱动程序设置传送参数
***
